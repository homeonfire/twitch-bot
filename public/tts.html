<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS –ú–æ–¥—É–ª—å (–î–∏–Ω–∞–º–∏–∫)</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #status { color: #4caf50; font-weight: bold; }
        #last-tts { color: #ffeb3b; }
    </style>
</head>
<body>
    <h2>–î–∏–Ω–∞–º–∏–∫ –¥–ª—è –±–æ—Ç–∞ üîä</h2>
    <p>–°—Ç–∞—Ç—É—Å: <span id="status">–û–∂–∏–¥–∞—é —Å–æ–æ–±—â–µ–Ω–∏—è...</span></p>
    <p>–ü–æ—Å–ª–µ–¥–Ω—è—è –æ–∑–≤—É—á–∫–∞: <span id="last-tts">–ø—É—Å—Ç–æ</span></p>

    <script>
        const statusEl = document.getElementById('status');
        const lastTtsEl = document.getElementById('last-tts');

        function checkTtsQueue() {
            fetch('/api/tts/next')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                        statusEl.innerText = "–û–∑–≤—É—á–∏–≤–∞—é...";
                        statusEl.style.color = "#ffeb3b";
                        lastTtsEl.innerText = data.username + ": " + data.message;

                        // –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ—Ä–∞–∑—É –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–∞
                        const textToSpeak = data.username + " –ø–∏—à–µ—Ç: " + data.message;
                        speakText(textToSpeak);
                    }
                })
                .catch(error => {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ TTS:", error);
                });
        }

        function speakText(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ru-RU'; 
            utterance.rate = 1.1; 
            
            // –ö–æ–≥–¥–∞ –±–æ—Ç –∑–∞–∫–æ–Ω—á–∏–ª –≥–æ–≤–æ—Ä–∏—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞—Ç–Ω–æ
            utterance.onend = function() {
                statusEl.innerText = "–û–∂–∏–¥–∞—é —Å–æ–æ–±—â–µ–Ω–∏—è...";
                statusEl.style.color = "#4caf50";
            };

            window.speechSynthesis.speak(utterance);
        }

        // –í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤: –∏–Ω–æ–≥–¥–∞ –∏–º –Ω—É–∂–µ–Ω –ø–µ—Ä–≤—ã–π "–∫–ª–∏–∫" –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, 
        // —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞. –ù–æ –≤ OBS Browser Source —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É.
        
        // –°—Ç—É—á–∏–º—Å—è –≤ –±–∞–∑—É –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(checkTtsQueue, 2000);
    </script>
</body>
</html>
